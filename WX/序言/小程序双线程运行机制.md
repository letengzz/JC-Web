# 微信小程序双线程运行机制

​	微信小程序的双线程运行机制 ：一个[逻辑层]()、一个[视图层]()。两者通过微信底层的`WeixinJSBridge`进行通讯，像我们在小程序`JavaScript`代码中使用`setData`改变视图绑定的数据，在底层其实对应执行的是`evaluateJavaScript`，这个函数还有当视图层的交互事件触发了，由视图层向逻辑层传递事件信息时也是通过这个函数进行的，这个函数的参数是文本 每一次调用都需要进行，原始类型到文本再到原始类型的转化，并且它还是单通道的 不存在像`Golang`、`C++`中那样的并发线程特征 所以它的效果可想而知是非常慢的。

理解这个双线程的通讯机制 对于我们优化小程序应用的性能很有帮助。

# 双线程架构

为了安全和管控 小程序使用双线程的架构 

**视图线程**(`View`)负责的是视图层 主要提供各类组件、渲染界面

**逻辑线程**(`App Service`)负责的是逻辑层 主要提供各种`API`来处理业务逻辑

这两者都是通过底层的`WeixinJSBridge`进行通讯的

![image-20220430144428668](D:/Data/typora/photo/image-20220430144428668.png)

​	上半部分左边是视图线程，右边是逻辑线程。

小程序的能力主要是两块，一个是组件一个是`api`分别对应的就是这左右两部分

视图层和逻辑层通过下面的`WeixinJSBridge`与微信底层的`Native`进行通讯在事件`Event`与数据`Data`的交互处理上逻辑层把数据变换通知到视图层 触发视图层更新 视图层再把触发的事件通知到逻辑层 进行业务逻辑的处理

